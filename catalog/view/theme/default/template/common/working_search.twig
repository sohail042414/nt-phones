<div id="search" class="input-group">
  <input type="text" name="search" value="{{ search }}" placeholder="{{ text_search }}" class="form-control input-lg" style="height: 55px; line-height: 30px; font-size: 17px;" />
  <span class="input-group-btn">
    <button type="button" class="btn btn-primary  btn-lg" style="line-height:32px;"><i class="fa fa-search"></i></button>
  </span>
</div>

<script>
// Autocomplete */
(function($) {
	$.fn.autocompletecustom = function(option) {
		return this.each(function() {
			var $this = $(this);
			var $dropdown = $('<ul class="dropdown-menu" style="width:100%;" />');

			this.timer = null;
			this.items = [];

			$.extend(this, option);

			$this.attr('autocomplete', 'off');

			// Focus
			$this.on('focus', function() {
				this.request();
			});

			// Blur
			$this.on('blur', function() {
				setTimeout(function(object) {
					object.hide();
				}, 200, this);
			});

			// Keydown
			$this.on('keydown', function(event) {
				switch(event.keyCode) {
					case 27: // escape
						this.hide();
						break;
					default:
						this.request();
						break;
				}
			});

			// Click
			this.click = function(event) {
				event.preventDefault();

				var value = $(event.target).parent().attr('data-value');

				if (value && this.items[value]) {
					this.select(this.items[value]);
				}
			}

			// Show
			this.show = function() {
				var pos = $this.position();

				$dropdown.css({
					top: pos.top + $this.outerHeight(),
					left: pos.left
				});

				$dropdown.show();
			}

			// Hide
			this.hide = function() {
				$dropdown.hide();
			}

			// Request
			this.request = function() {
				clearTimeout(this.timer);

				this.timer = setTimeout(function(object) {
					object.source($(object).val(), $.proxy(object.response, object));
				}, 200, this);
			}

			// Response
			this.response = function(json) {
        console.log(json);
				var html = '';
				var category = {};
				var name;
				var i = 0, j = 0;

				if (json.length) {
					for (i = 0; i < json.length; i++) {
						// update element items
						this.items[json[i]['value']] = json[i];

						if (!json[i]['category']) {
							// ungrouped items
							//html += '<li data-value="' + json[i]['value'] + '"><a href="#">' + json[i]['label'] + '</a></li>';
              html += '<li data-value="' + json[i]['value'] + '">';
              html += '<a href="'+json[i]['href']+'">' + json[i]['label'] + '</a>';
              html += '<img class="img-responsive" src="'+json[i]['img']+'" title="'+ json[i]['label']+'">';
              html += '</li>';
						
            } else {
							// grouped items
							name = json[i]['category'];
							if (!category[name]) {
								category[name] = [];
							}

							category[name].push(json[i]);
						}
					}

					for (name in category) {
						html += '<li class="dropdown-header">' + name + '</li>';

						for (j = 0; j < category[name].length; j++) {
							html += '<li data-value="' + category[name][j]['value'] + '">';
              html += '<a href="'+json[i]['href']+'">&nbsp;&nbsp;&nbsp;' + category[name][j]['label'] + '</a>';
              html +=' </li>';
						}
					}
				}

				if (html) {
					this.show();
				} else {
					this.hide();
				}

				$dropdown.html(html);
			}

			//$dropdown.on('click', '> li > a', $.proxy(this.click, this));
			$this.after($dropdown);
		});
	}
})(window.jQuery);

</script>
<script>
  $('input[name=\'search\']').autocompletecustom({
	  'source': function(request, response) {
		  $.ajax({
			  url: 'index.php?route=common/search/autocomplete&search=' + encodeURIComponent(request),
			  dataType: 'json',
			  success: function(json) {
          /*
				  json.unshift({
					  manufacturer_id: 0,
					  name: '{{ text_none }}'
				  });
          */
				  response($.map(json, function(item) {
					  return {
						  label: item['name'],
						  value: item['product_id'],
              href : item['href'],
              img : item['img']
					  }
				  }));
			  }
		  });
	  },
	  'select': function(item) {
		  $('input[name=\'manufacturer\']').val(item['label']);
		  $('input[name=\'manufacturer_id\']').val(item['value']);
	  }
  });
</script>